 Hello everybody, in this lesson, we're going to be taking a look at subqueries in my SQL. As subquery is basically just a query within another query. We can do this in a few different ways, and I'm going to try to show you a lot of the different variations within this lesson. The first way that we're going to use a subquery is in the Wear clause. Then we'll take a look at the Select and the From clause also. Let's take this demographics table that we have down here. What if we only wanted to select the employees who worked in the actual Parks and Rec department? Well, we could do that if we had a few joins. We have this salary table. And one actually represents that they work for the Parks and Rec. If we come over here and we open this up, we can see that Parks and Rec is the department idea of one. So we do have that option. We could just join these two tables together, but sometimes we don't want to do that and we'll use a subquery. Let's see how it works in the Wear clause. So let's go ahead and get rid of this. So what we're going to do is we're going to select everything from employee demographics Wear. And now we want to pull because this is the salary table. We want to pull employee IDs where the department ID is equal to one. Remember, we're querying off of this table. So let's actually pull this up. This is what we're working with. So we want to say, Wear the employee underscore ID. That's referencing this column in the demographics table. Is in what we're going to do is we're going to do a parentheses here. And we can even come down and put a parentheses down here. So what we're going to do now is write our query, which is our subquery. And this is our outer query. So now we're going to write an entirely other query within this. We'll say select. And now we're going to say employee underscore ID. And let's just bring this over. I usually have it something like this. And I'm going to try to bring this down a little bit. So select everything. And then we'll do from. And then instead of employee demographics, we'll do employee salary. And let's just format this a little better. So select the employee ID from employee salary. And remember, we wanted to do Wear the department ID is equal to one. Now let's bring this back up. And this is what the query is going to look like now. Just by itself, let's run this subquery or this inner query. When we run this, it's going to create this list of just employee IDs where the department ID is equal to one. So when we say Wear the employee ID from the employee demographics table is in, it's going to try to match those employee IDs to this list of employee IDs. So just remember one, two, three, four, five, six, and 12. Let's go ahead and run this entire query. Now we have one, three, four, five, six, 12. If you remember from previous lessons, the two is Ron Swanson. And he's only in the salary table. So since we're doing just the employee demographics table, he's not in here. So what we're doing is we're selecting everything from the employee demographics, where the employee ID in this table matches or is in the select employee ID from the salary table, where the department ID is equal to one. In essence, this is what a subquery is. It's a query within a query. Now what would happen if we have the employee ID, but we also wanted to say the department ID, because we just wanted to view this. Let's go ahead and try to run this. We are going to get no output. And we're going to get an error that says op-rand should contain one column. The op-rand referring to this entire thing right here, because this is an operator. So this is our op-rand. And we're returning two columns in here, which is saying we cannot do. We have to only have one. So now if we run this, it works perfectly well. Let's bring that down. Now we can also use the subquery in a select statement. So let's take a look at that next. Let's go down here. And let's say we want to do select everything from employee underscore salary. And let me spell that right. Let's say we want to look at all the salaries just like how we have it now. But in a column next to it, we also want to compare it to the average salary for everyone. So we'll be able to see whether somebody's salary is above average or below average. So what we would try to do potentially is do something like first underscore name, salary, and average salary. And we try to run this. And of course, we're going to get an error. It's going to basically tell us that we need to group by if we're doing this. So let's go back down. And let's actually add that group by. And we'll say group by first name and salary. And we'll look at this output. And this is not looking good at all. It's just looking at the average salary for each unique row, which is Leslie 75,000. So the average is 75,000. This is not what we're looking for. This is not what we want. Here's what we really do want. We want to just take the average salary of this entire column, regardless of group by or anything else. So let's get rid of this and let's see how we can do that. So let's come right down here. We're going to say select, select the average salary. And then we're going to say from our parentheses, because this is our sub query from the employee salary table, just like that. Now if we run this, we should get the exact output we're looking for. So the average salary is 57,250. And we have our salary right here. So we can compare really quickly just like that. And we can also use a sub query in the from statement. So let's go down here. And let's say select everything from employee underscore demographics. Have it autocomplete for me. So we have the employee demographics table. Now let's create a group by based off the gender column and add some aggregated functions. And I'm going to show you how you can use this as a sub query. Let's go up here. Say gender. And then we'll go ahead and add our group by. So say group by gender as well. Now let's add a few things. We'll do average. We'll do average age. And then we can do let's just do all of them based off the age. We'll just do age. Men of age and count of age. Oh, I try to write fast. It doesn't always go right. So we have this. Let's run this. And this is what our output is going to look like. Now what if we wanted to get the average of the oldest age or the average of the smallest ages or you know, see what the average count is for males and females. Well, we can't do that given this table. But let's do something right here. Select everything. And then we're going to say from an in our from statement, we're going to have a parentheses. We're going to paste our select statement and then close the parentheses. So we're going to select everything from this output that is right down here. So if we run just this, we're going to get an error in. Forgot this is going to happen. But every drive table must have its own alias. So you have to name a table. I forgot it does that. All we have to do to fix this is just name it. So we'll say as and we'll say aggregated table. We'll just call it aggregated table. So let's run this and we get the exact same output. But here's the neat thing is we can now select. We can do gender. And these are actually the column names now. So I can do the average of this column right here. But I can't do it just like this because it's going to give us an error. And I'll show you why in just a second says unknown column age in field list. So what it's saying is is we're trying to perform an aggregated function on the aggregation of an age column. But we don't have an age column in our table right here. Let me run this again. We have a column named this exact thing. So we actually need to do is do this backtick and backtick. This is the actual name of the column. It's not an aggregation anymore. The backtick on my laptop is right above the tab on the far left hand side right under the escape. That's where mine is. So these backticks, it's not a quote like this. It's a backtick. So you just need to find that on your keyboard. But now if we run this, it looks like we encountered another error says in aggregated query without group by that's right. Now we need a group by. So now we need a group by gender. Sometimes you got to figure this out on the fly. And it should work. There we go. So now we can perform aggregations on this table. Now this doesn't actually work perfect because we're still grouping by the female male. But let's get rid of this for a second. And we'll get rid of this group by entirely. And if we run this, we're now looking at the averages of this column right here, max age. Now when you're doing something like this, it's actually really smart to rename these. We'll say as average underscore age. We'll say as max underscore age. And it makes it so much easier. You don't have to do these back ticks anymore. And as men underscore age and so on and so forth. And I would probably format this better and stuff like that. We don't have to go through everything right. I'm just going to give you an example. But then when we're using this table, these columns are actually named this. So I don't have to do these back ticks anymore. I can just take this whole thing. Oops, you're not sure where that back tick. Now I can just take this column because this is the column name. So let's go ahead and run this. And it's still going to work perfectly. So this one's pretty cool because you're basically creating this kind of like a temp table. You're just creating your own little output. Then you can query off of it and you could do more advanced calculations this way. It's actually really useful. But there are better ways to do something like this, like a CTE or a temp table that will look at in the advanced series. But this is at least how you can do it and you can actually try it out using sub queries. So that is all we're going to look at today for sub queries in the next lesson. We're going to take a look at window functions.